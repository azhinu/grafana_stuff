apiVersion: 1
groups:
    - orgId: 1
      name: Clickhouse
      folder: MAIN
      interval: 1m
      rules:
        - uid: eO4Fa737k
          title: Clickhouse Query Latency
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 300
                to: 0
              datasourceUid: PBFA97CFB590B2093
              model:
                datasource:
                    type: prometheus
                    uid: PBFA97CFB590B2093
                editorMode: code
                exemplar: true
                expr: increase(ClickHouseProfileEvents_QueryTimeMicroseconds[$__rate_interval]) / increase(ClickHouseProfileEvents_Query[$__rate_interval]) / 1000
                interval: ""
                intervalMs: 15000
                legendFormat: ""
                maxDataPoints: 43200
                range: true
                refId: A
            - refId: B
              relativeTimeRange:
                from: 300
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 0
                            - 0
                        type: gt
                      operator:
                        type: and
                      query:
                        params: []
                      reducer:
                        params: []
                        type: avg
                      type: query
                datasource:
                    name: Expression
                    type: __expr__
                    uid: __expr__
                expression: A
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: max
                refId: B
                type: reduce
            - refId: C
              relativeTimeRange:
                from: 300
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 100
                            - 0
                        type: gt
                      operator:
                        type: and
                      query:
                        params: []
                      reducer:
                        params: []
                        type: avg
                      type: query
                datasource:
                    name: Expression
                    type: __expr__
                    uid: __expr__
                expression: B
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          dashboardUid: j7LIb2Xnk
          panelId: 21
          noDataState: OK
          execErrState: OK
          for: 0s
          annotations:
            __dashboardUid__: j7LIb2Xnk
            __panelId__: "21"
            description: |-
                Clickhouse have queries that running more than {{ humanize $values.B.Value }} seconds.

                Try look to system.processes with long queries

                https://clickhouse.com/docs/en/operations/system-tables/processes

                `clickhouse-client -q "SELECT * FROM system.processes WHERE elapsed >= 100 FORMAT Vertical" | less`
            summary: Some Clickhouse queries get more than 100ms
          labels:
            severity: warning
          isPaused: false
        - uid: XlfGiMyVz
          title: Clickhous restarted
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: PBFA97CFB590B2093
              model:
                editorMode: code
                expr: ClickHouseAsyncMetrics_Uptime
                hide: false
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: true
                refId: A
            - refId: B
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - B
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: last
                refId: B
                type: reduce
            - refId: C
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 70
                        type: lt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: B
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          noDataState: OK
          execErrState: OK
          for: 0s
          annotations:
            summary: Clickhouse restarted!
          labels:
            severity: info
          isPaused: false
        - uid: WEiImGyVz
          title: Clickhouse status
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: PBFA97CFB590B2093
              model:
                editorMode: code
                expr: count(ClickHouseMetrics_VersionInteger)
                hide: false
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: true
                refId: A
            - refId: B
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - B
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: last
                refId: B
                type: reduce
            - refId: C
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 1
                        type: lt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: B
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          noDataState: NoData
          execErrState: Error
          for: 0s
          annotations:
            summary: Clickhouse is down!
          labels:
            severity: critical
          isPaused: false
        - uid: izI2MMsVz
          title: Clickhouse too many queries
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 3600
                to: 0
              datasourceUid: PBFA97CFB590B2093
              model:
                editorMode: code
                expr: ClickHouseMetrics_Query
                hide: false
                interval: 15s
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: true
                refId: A
            - refId: B
              relativeTimeRange:
                from: 3600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - B
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: last
                refId: B
                type: reduce
            - refId: C
              relativeTimeRange:
                from: 3600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 100
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: B
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          noDataState: OK
          execErrState: OK
          for: 2m
          annotations:
            description: 'Counted **{{ $values.B.Value }}** simultaneous queries. Maximum: 100 (by default)'
            summary: Too many simultaneous queries
          labels:
            severity: info
          isPaused: false
        - uid: ZvMfMJs4z
          title: ClickHouse Rejected Insert
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: PBFA97CFB590B2093
              model:
                editorMode: code
                expr: increase(ClickHouseProfileEvents_RejectedInserts[1m])
                hide: false
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: true
                refId: A
            - refId: B
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - B
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: max
                refId: B
                type: reduce
            - refId: C
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 48
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: B
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          noDataState: OK
          execErrState: OK
          for: 5m
          annotations:
            description: clickhouse-server have {{ $values.B.Value }} INSERT queries that are rejected due to high number of active data parts for partition in a MergeTree, please decrease INSERT frequency
            summary: Rejected INSERT queries occurred
          labels:
            severity: critical
          isPaused: false
        - uid: J7qqGJyVk
          title: ClickHouse Delayed Insert Throttling
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: PBFA97CFB590B2093
              model:
                editorMode: code
                expr: increase(ClickHouseProfileEvents_DelayedInserts[1m])
                hide: false
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: true
                refId: A
            - refId: B
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - B
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: max
                refId: B
                type: reduce
            - refId: C
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 0
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: B
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          noDataState: OK
          execErrState: OK
          for: 0s
          annotations:
            description: Clickhouse have {{ $values.B.Value }} INSERT queries that are throttled due to high number of active data parts for partition in a MergeTree, please decrease INSERT frequency
            summary: Delayed INSERT queries occurred
          labels:
            severity: warning
          isPaused: false
        - uid: D_lOnJy4k
          title: ClickHouse Max Part Count For Partition
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: PBFA97CFB590B2093
              model:
                editorMode: code
                expr: ClickHouseAsyncMetrics_MaxPartCountForPartition
                hide: false
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: true
                refId: A
            - refId: B
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - B
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: last
                refId: B
                type: reduce
            - refId: C
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 100
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: B
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          noDataState: OK
          execErrState: OK
          for: 0s
          annotations:
            description: |-
                Clickhouse have too many parts ({{ $values.B.Value }}) in one partition.
                Clickhouse MergeTree table engine split each INSERT query to partitions (PARTITION BY expression) and add one or more PARTS per INSERT inside each partition, after that background merge process run, and when you have too much unmerged parts inside partition, SELECT queries performance can significate degrade, so clickhouse try delay or reject INSERT
            summary: Max parts per partition > 100
          labels:
            severity: warning
          isPaused: false
        - uid: utcSI1sVz
          title: ClickHouse Low Inserted Rows Per Query
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: PBFA97CFB590B2093
              model:
                editorMode: code
                expr: (increase(ClickHouseProfileEvents_InsertQuery[1m]) / increase(ClickHouseProfileEvents_InsertedRows[1m]) > 0) and increase(ClickHouseProfileEvents_InsertedRows[1m]) > 0
                hide: false
                interval: 1m
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: true
                refId: A
            - refId: B
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - B
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: last
                refId: B
                type: reduce
            - refId: C
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 1000
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: B
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          noDataState: OK
          execErrState: OK
          for: 0s
          annotations:
            description: |-
                Clickhouse have low insert speed ({{ $values.B.Value }}).
                https://clickhouse.com/docs/en/about-us/performance/#performance-when-inserting-data
                Clickhouse team recommends inserting data in packets of at least 1000 rows or no more than a single request per second.
                Please use Buffer table
                https://clickhouse.com/docs/en/engines/table-engines/special/buffer/
                or
                https://clickhouse.com/docs/en/operations/settings/settings/#async-insert
            summary: Please increase inserted rows per INSERT query
          labels:
            severity: warning
          isPaused: false
        - uid: JynlI1y4z
          title: ClickHouse Query Preempted
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: PBFA97CFB590B2093
              model:
                editorMode: code
                expr: ClickHouseMetrics_QueryPreempted
                hide: false
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: true
                refId: A
            - refId: B
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - B
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: max
                refId: B
                type: reduce
            - refId: C
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 0
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: B
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          noDataState: OK
          execErrState: OK
          for: 0s
          annotations:
            description: |-
                Clickhouse have **{{ $values.B.Value }}** preempted queries.

                It mean queries that are stopped and waiting due to 'priority' setting.

                Try look to system.processes

                https://clickhouse.com/docs/en/operations/system-tables/processes

                `clickhouse-client -q "SELECT * FROM system.processes FORMAT Vertical" | less`
            summary: Preempted queries occurred
          labels:
            severity: warning
          isPaused: false
        - uid: FepP1-y4z
          title: ClickHouse Too Many Connections
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: PBFA97CFB590B2093
              model:
                datasource:
                    type: prometheus
                    uid: PBFA97CFB590B2093
                editorMode: code
                exemplar: false
                expr: ClickHouseMetrics_HTTPConnection + ClickHouseMetrics_TCPConnection
                interval: 15s
                intervalMs: 60000
                legendFormat: __auto
                maxDataPoints: 200
                range: true
                refId: A
            - refId: B
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: max
                refId: B
                type: reduce
            - refId: C
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 100
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - D
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: B
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          dashboardUid: thEkJB_Mz
          panelId: 73
          noDataState: OK
          execErrState: OK
          for: 0s
          annotations:
            __dashboardUid__: thEkJB_Mz
            __panelId__: "73"
            description: |-
                ClickHouse have many open connections (**{{ $values.B.Value }}** connections).

                The ClickHouse is adapted to run not a very large number of parallel SQL requests, not every HTTP/TCP(Native)/MySQL protocol connection means a running SQL request, but a large number of open connections can cause a spike in sudden SQL requests, resulting in performance degradation.

                Also read documentation:

                https://clickhouse.com/docs/en/operations/server-configuration-parameters/settings/#max-concurrent-queries
            summary: Total connections > 100
          labels:
            severity: warning
          isPaused: false
        - uid: Qyuvx-y4z
          title: ClickHouse Concurrent queries
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: PBFA97CFB590B2093
              model:
                datasource:
                    type: prometheus
                    uid: PBFA97CFB590B2093
                editorMode: code
                expr: ClickHouseMetrics_Query
                interval: "15"
                intervalMs: 15000
                legendFormat: Queries
                maxDataPoints: 43200
                range: true
                refId: A
            - refId: B
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - B
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: max
                refId: B
                type: reduce
            - refId: C
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 80
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: B
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          dashboardUid: thEkJB_Mz
          panelId: 132
          noDataState: OK
          execErrState: OK
          for: 0s
          annotations:
            __dashboardUid__: thEkJB_Mz
            __panelId__: "132"
            description: |-
                Clickhouse have **{{ $values.B.Value }}** running queries. Please analyze your workload.

                Each concurrent SELECT query use memory in JOINs use CPU for running aggregation function and can read lot of data from disk when scan parts in partitions and utilize disk I/O.

                Each concurrent INSERT query, allocate around 1MB per each column in an inserted table and utilize disk I/O.

                Look at following documentation parts:

                - https://clickhouse.com/docs/en/operations/settings/query-complexity/
                - https://clickhouse.com/docs/en/operations/quotas/
                - https://clickhouse.com/docs/en/operations/server-configuration-parameters/settings/#max-concurrent-queries
                - https://clickhouse.com/docs/en/operations/system-tables/query_log/
            summary: Too much running queries
          labels:
            severity: warning
          isPaused: false
        - uid: J1Nx--yVk
          title: ClickHouse Storage Buffer Error On Flush
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: PBFA97CFB590B2093
              model:
                editorMode: code
                expr: increase(ClickHouseProfileEvents_StorageBufferErrorOnFlush[1m])
                hide: false
                interval: 1m
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: true
                refId: A
            - refId: B
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - B
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: max
                refId: B
                type: reduce
            - refId: C
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 0
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: B
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          noDataState: OK
          execErrState: OK
          for: 0s
          annotations:
            description: |-
                Clickhouse increase StorageBufferErrorOnFlush in `system.events` table.

                It mean something went wrong when clickhouse-server try to flush memory buffers to disk.

                Please check following things:
                - Check disks free space and hardware failures
                - Logs on clickhouse-server pods
            summary: Increased StorageBufferErrorOnFlush
          labels:
            severity: warning
          isPaused: false
        - uid: TSKC--s4z
          title: ClickHouse Read from FD failed
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: PBFA97CFB590B2093
              model:
                datasource:
                    type: prometheus
                    uid: PBFA97CFB590B2093
                editorMode: code
                exemplar: false
                expr: increase(ClickHouseProfileEvents_ReadBufferFromFileDescriptorReadFailed[1m])
                hide: false
                interval: ""
                intervalMs: 60000
                legendFormat: trend - {{instance}}
                maxDataPoints: 200
                range: true
                refId: A
            - refId: B
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - B
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: max
                refId: B
                type: reduce
            - refId: C
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 0
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - D
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: B
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          dashboardUid: thEkJB_Mz
          panelId: 24
          noDataState: OK
          execErrState: OK
          for: 0s
          annotations:
            __dashboardUid__: thEkJB_Mz
            __panelId__: "24"
            description: |-
                Occured **{{ $values.B.Value }}** file descriptor read error.

                System can't read  some files.
                Please check logs on clickhouse-server
            summary: Read from file descriptor failed
          labels:
            severity: warning
          isPaused: false
        - uid: w2KTLay4k
          title: ClickHouse Write to FD failed
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: PBFA97CFB590B2093
              model:
                datasource:
                    type: prometheus
                    uid: PBFA97CFB590B2093
                editorMode: code
                exemplar: false
                expr: increase(ClickHouseProfileEvents_WriteBufferFromFileDescriptorWriteFailed[1m])
                hide: false
                interval: 1m
                intervalMs: 60000
                legendFormat: __auto
                maxDataPoints: 200
                range: true
                refId: A
            - refId: B
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - B
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: max
                refId: B
                type: reduce
            - refId: C
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 0
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - D
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: B
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          dashboardUid: thEkJB_Mz
          panelId: 25
          noDataState: OK
          execErrState: OK
          for: 0s
          annotations:
            __dashboardUid__: thEkJB_Mz
            __panelId__: "25"
            description: |-
                Occured **{{ $values.B.Value }}** file descriptor write error.

                System can't write to  some files.
                Please check logs on clickhouse-server
            summary: Write buffer to file descriptor failed
          labels:
            severity: warning
          isPaused: false
        - uid: UlS_LayVk
          title: ClickHouse Slow reads
          condition: D
          data:
            - refId: A
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: PBFA97CFB590B2093
              model:
                datasource:
                    type: prometheus
                    uid: PBFA97CFB590B2093
                editorMode: code
                exemplar: false
                expr: increase(ClickHouseProfileEvents_SlowRead[1m])
                interval: 1m
                intervalMs: 60000
                legendFormat: __auto
                maxDataPoints: 200
                range: true
                refId: A
            - refId: B
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - B
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: max
                refId: B
                type: reduce
            - refId: D
              relativeTimeRange:
                from: 60
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 0
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - D
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: B
                hide: false
                intervalMs: 1000
                maxDataPoints: 43200
                refId: D
                type: threshold
          dashboardUid: thEkJB_Mz
          panelId: 71
          noDataState: OK
          execErrState: OK
          for: 0s
          annotations:
            __dashboardUid__: thEkJB_Mz
            __panelId__: "71"
            description: |-
                Increased SlowRead in `system.events` table. (**{{ $values.B.Value }}** slow reads)

                It mean reads from a files that were slow. This indicate system overload. Thresholds are controlled by `SELECT * FROM system.settings WHERE name LIKE 'read_backoff_%'`.

                System will reduce the number of threads which used for processing queries.

                Check you disks utilization and hardware failures.
            summary: Increased SlowRead
          labels:
            severity: warning
          isPaused: false
